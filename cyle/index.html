<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="./js/cys2.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cnchar/cnchar.min.js"></script>
  <script src="/log?type=cydl&remark=new"></script>
  <title>æˆè¯­le</title>
  <style>
    body {
      text-align: center;
      padding: 0;
    }
    .container {
      position: relative;
      display: inline-block;
      padding: 2px;
      padding-top: 36px;
      max-width: 800px;
      margin: auto;
      height: calc(100vh - 58px);
    }
    #root.default {
      --background: #ffffff;
      --loc-background: #69a86a;
      --eql-background: #c9b457;
      --eql-color: #ffffff;
      --loc-color: #ffffff;
      --color: #1c1c1c;
      --border-color: #7b7b7b;
      --drop-color: #ffffff;
      --drop-background: #7d7d7d;
      --font-size: 28px;
      --zi-border-width: 2px;
    }
    #root.china-year {
      --background: #efefef;
      --loc-background: #c22828;
      --color: #999999;
      --py-color: #12171b;
      --eql-color: #e1d791;
      --eql-background: none;
      --font-size: 28px;
      --border-color: #efefef;
      --drop-color: #cccccc;
      --drop-background: var(--background);
      --zi-border-width: 0px;
    }
    #box {
      border: 2px solid var(--border-color);
      padding: 2px;
      margin-top: 2px;
    }
    .chengyu {
      font-size: 0;
    }
    .chengyu:first-child {
      margin-left: 0px;
    }
    #history {
      height: calc(100vh - 360px);
      overflow: auto;
    }
    .zi {
      display: inline-block;
      margin: 2px;
      width: 60px;
      height: 60px;
      color: var(--color);
      background-color: var(--background);
      text-align: center;
      vertical-align: middle;
      line-height: 60px;
      font-size: var(--font-size);
      border: 2px solid var(--border-color);
      border-width: var(--zi-border-width);
    }
    .zi.py {
      color: var(--py-color);
    }
    .zi.loc {
      background: var(--loc-background) 
    }
    #root.default .zi.loc {
      color: var(--loc-color);
    }
    .zi.eql {
      color: var(--eql-color);
    }
    #root.default .zi.eql {
      background: var(--eql-background);
    }
    #root.default .zi.eql.loc {
      background: var(--loc-background);
    }
    .zi.drop {
      color: var(--drop-color);
      background: var(--drop-background);
    }
    #input {
      margin: 10px 0px;
    }
    #fk,
    #cyid,
    #fx,
    #help-icon,
    #close-help {
      position: absolute;
      display: inline-block;
      width: 80px;
      top: 2px;
      margin: auto;
      cursor: pointer;
    }
    #fk {
      left: 0;
    }
    #cyid {
      /* left: 0; */
      right: 0;
    }
    #help-icon {
      left: 0;
      right: 0;
    }
    #close-help {
      width: 60px;
      right: 0;
      background: var(--background);
      border-radius: 4px;
      z-index: 1;
    }
    #fx {
      right: 0;
    }
    .hide {
      position: absolute;
      top: -100px;
    }
    #help {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      overflow: hidden;
      margin: auto;
      box-shadow: 2px 2px 5px 2px;
      width: 90%;
      height: 90%;
      text-align: center;
      background: #ffffff;
      border-radius: 4px;
    }
    #help #help-container {
      position: absolute;
      left: 0;
      top: 0;
      display: inline-block;
      height: 100%;
      width: 100%;
      overflow: auto;
      padding: 4px;
      height: 100%;
      overflow: auto;
    }
    .img {
      width: 100%;
    }
    #help p {
      text-align: left;
    }
    /* è®¾ç½®æ»šåŠ¨æ¡çš„æ ·å¼ */
    ::-webkit-scrollbar {
      width:8px;
    }
    /* æ»šåŠ¨æ§½ */
    ::-webkit-scrollbar-track {
      -webkit-box-shadow:inset006pxrgba(0,0,0,0.3);
      border-radius:8px;
    }
    /* æ»šåŠ¨æ¡æ»‘å— */
    ::-webkit-scrollbar-thumb {
      border-radius:8px;
      background:rgba(0,0,0,0.1);
      -webkit-box-shadow:inset006pxrgba(0,0,0,0.5);
    }
    /* ::-webkit-scrollbar-thumb:window-inactive {
      background:rgba(255,0,0,0.4);
    } */
  </style>
</head>
<body>
  <div class="container">
  <div class="box" id="root">
    <div class="chengyu" id="c">
      <div class="zi z1">å¤©</div>
      <div class="zi z2"></div>
      <div class="zi z3"></div>
      <div class="zi z4"></div>
    </div>
    <div class="chengyu" id="box"></div>
    <input id="input" onsubmit="check()"></input>
    <button onclick="check()">æäº¤</button>
    <div id="history"></div>
    <div id="cyid" onclick="setId()"></div>
    <!-- <div id="fx" onclick="share()">åˆ†äº«</div> -->
    <div id="fk" onclick="feedback()">åé¦ˆ</div>
    <div id="help-icon" onclick="openHelp()">â“</div>
    <div id="help" style="display: none;">
      <div id="close-help" onclick="closeHelp()">å…³é—­</div>
      <div id="help-container">
      <div>
        <h2>ç›²çŒœæˆè¯­æ¸¸æˆè§„åˆ™</h2>
<p>1. çŒœçš„å¿…é¡»ä¸ºæˆè¯­ï¼ŒçŒœä¸€æ¬¡ç‚¹å‡»â€œæäº¤â€ï¼Œç³»ç»Ÿè‡ªåŠ¨å­˜æ¡£ï¼Œéæˆè¯­ä¼šæç¤ºâ€œè¯·è¾“å…¥æ­£ç¡®çš„æˆè¯­â€ä¸”è¯¥æ¬¡ä¸å­˜æ¡£</p>
<p>2. å¦‚æœæ­£ç¡®è¾“å…¥æˆè¯­ï¼Œç³»ç»Ÿå´æç¤ºâ€œè¯·è¾“å…¥æ­£ç¡®çš„æˆè¯­â€ï¼Œè¯·ç‚¹å‡»å·¦ä¸Šè§’â€œåé¦ˆâ€ï¼Œæˆè¯­åº“éœ€è¦å¤§å®¶çš„æ”¯æŒå®Œå–„ï½</p>
<p>3. å³ä¸Šè§’æ•°å­—ä»£ç ç‚¹å‡»åå¯ä»¥é‡æ–°ç”Ÿæˆå½“å‰å…³å¡ï¼Œé€‚åˆåˆ†äº«ç»™å°ä¼™ä¼´ä¸€èµ·ç©ğŸ˜Š</p>
<p>4. æ¯æ¬¡çŒœæˆè¯­åï¼Œå¤‡é€‰åŒºç”¨è¿‡çš„å­—ä»¥åŠçŒœçš„æˆè¯­ä¸­çš„å­—ä¼šå˜é¢œè‰²ï¼Œå…·ä½“é¢œè‰²å˜åŒ–ä¼šåœ¨ä¸‹æ–¹å›¾ç‰‡ä¸­è¯´æ˜</p>
      </div>
      <img class="img" src="img/help2.jpg"/>
      </div>
    </div>
  </div>
  </div>
  <script>
      console.log('ä½ å¥½å‘€ï¼Œç¨‹åºå‘˜ï¼Œå¯ä»¥åŠ æˆ‘å¾®ä¿¡ä¸€èµ·äº¤æµï¼šmaqijun123456');
      var tarCy = 'å¤©ä¸‹ç¬¬ä¸€';
      var isRandom = true
      var cyid;
      var isChinaYear = false;
      var isPyMode = false;
      if (isChinaYear) {
        document.getElementById('root').classList.remove('default');
        document.getElementById('root').classList.add('china-year');
      } else {
        document.getElementById('root').classList.remove('china-year');
        document.getElementById('root').classList.add('default');
      }
      if (isRandom) {
        if (window.location.href.indexOf('cyid') > -1) {
          cyid = window.location.href.match(/cyid=(\d*)/)[1]
        } else {
          cyid = Math.random()*cys.length|0;
          if (window.location.href.indexOf('tekii.cn') > -1) {
            window.history.pushState({id: 1,name: "SpecialGame"}, "SpecialGame", "/cyle/?cyid="+cyid);
          }
        }
        var cyid_ele = document.getElementById('cyid');
        cyid_ele.innerHTML = cyid;
        tarCy = cys[cyid];
        document.querySelector('.z1').innerHTML = '';
      }
      if (!localStorage.isOld) {
        openHelp()
      }
      function openHelp() {
        console.log('jopen')
        var help_ele = document.getElementById('help');
        help_ele.style.display = 'inline-block'
      }
      function closeHelp() {
        localStorage.isOld = '1'
        var help_ele = document.getElementById('help');
        help_ele.style.display = 'none'
      }
      function setId() {
        var specialCyId = prompt('è¯·è¾“å…¥æˆè¯­id');
        if (specialCyId) {
          window.location.href = "/cyle/?cyid="+specialCyId
        }
      }
      function share() {
        var url = window.location.href;
        function copy(value) {
          var oInput = document.createElement("input");  //input çš„ID
          oInput.className = 'hide'
          document.body.appendChild(oInput)
          oInput.value = value
          oInput.select(); //é€‰æ‹©å¯¹è±¡  
          document.execCommand("Copy"); //æ‰§è¡Œæµè§ˆå™¨å¤åˆ¶å‘½ä»¤
          document.body.removeChild(oInput)
        }
        copy(window.location.host+"/cyle/?cyid="+cyid)
        alert('å·²å°†æœ¬æˆè¯­å¯¹åº”çš„ç½‘å€å¤åˆ¶åˆ°å‰ªåˆ‡æ¿ï¼Œå¯ä»¥ç²˜è´´åˆ†äº«ç»™æœ‹å‹ä»¬äº†')
      }
      function feedback() {
        var fk = prompt('è¯·è¾“å…¥åé¦ˆå†…å®¹ï¼ˆä¸è¦å¸¦emojiå“ˆï¼‰');
        if (!fk) return;
        var name = localStorage.name || prompt('è¯·è¾“å…¥æ‚¨çš„ç§°å‘¼æˆ–è”ç³»æ–¹å¼(æ–¹ä¾¿åç»­åŒºåˆ†)ï¼Œä»…éœ€è¾“å…¥ä¸€æ¬¡');
        localStorage.name = name;
        if (fk) {
          var xhr = new XMLHttpRequest();
          xhr.open('GET', '//tekii.cn/log?type=cydl&remark='+fk + '|' + name + '|' + cyid, true);
          xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
          xhr.send('');
          xhr.onreadystatechange = function() {
            if (xhr.readyState == 4) {
              if (xhr.status == 200) {
                alert('åé¦ˆæˆåŠŸï¼Œæ„Ÿè°¢æ‚¨çš„åé¦ˆï¼')
              } else {
                alert('å¤±è´¥äº†T^Tï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜ï¼Œä¹Ÿå¯èƒ½æ˜¯åé¦ˆå†…å®¹åŒ…å«äº†æ— æ³•è¯†åˆ«çš„è¡¨æƒ…')
              }
            }
          }
        }
      }
      var nowId = 1;
      var checkCnt = 0;

      function getBoxZis(size=10, true_size=2) {
        var box = document.querySelector('#box');
        var box_zis = []
        var true_cy_idxs = []
        while (box_zis.length < size) { // éšæœºå–å¯¹åº”å€¼
          var other_cy = cys[Math.random() * cys.length | 0];
          var other_zi = other_cy[Math.random() * other_cy.length | 0].replace(/\s/g, '');
          if (box_zis.indexOf(other_zi) == -1) {
            box_zis.push(other_zi);
          }
        }
        var true_num = 0;
        var true_idxs = []
        while (true_num < true_size) {
          rand_zi = tarCy[Math.random() * tarCy.length | 0].replace(/\s/g, '');
          rand_idx = Math.random() * box_zis.length | 0;
          if (box_zis.indexOf(rand_zi) === -1 && true_idxs.indexOf(rand_idx) === -1) {
            box_zis[rand_idx] = rand_zi
            true_num++
          }
        }
        for (var i = 0; i < box_zis.length; i++) {
          var zi = box_zis[i];
          var zi_el = document.createElement('div');
          zi_el.className = 'zi';
          zi_el.classList.add('z'+(i+1));
          zi_el.innerHTML = zi;
          box.appendChild(zi_el);
        }
        return box_zis;
      }
      var box_zis = getBoxZis()

      function check() {
        var input = document.getElementById('input');
        var value = input.value || '';
        value = value.replace(/\s/g, '')
        if (value.length === 0) {
          alert('è¯·è¾“å…¥æˆè¯­');
          return;
        }
        if (value.length < 4) {
          alert('æˆè¯­é•¿åº¦ä¸å¤Ÿ');
          return;
        }
        if (value.length > 4) {
          alert('æˆè¯­é•¿åº¦å¤ªé•¿');
          return;
        }
        if (!checkIsCy(value)) {
          alert('è¯·è¾“å…¥æ­£ç¡®çš„æˆè¯­');
          return;
        }
        var pyArr = checkPy(value, tarCy);
        var locArr = checkLoc(value, tarCy);
        var eqlArr = checkEql(value, tarCy);
        update_cy('');
        update_cy(nowId);
        function newC(id) {
          var c_ele = document.createElement('div')
          c_ele.className = "chengyu";
          c_ele.id = "c"+id;
          c_ele.innerHTML = `
            <div class="zi z1"></div>
            <div class="zi z2"></div>
            <div class="zi z3"></div>
            <div class="zi z4"></div>
          `
          var history_ele = document.getElementById('history');
          history_ele.appendChild(c_ele);
          history_ele.scrollTop = history_ele.scrollHeight
          return c_ele;
        }
        function update_cy(nowId) {
          var ci_ele = document.querySelector('#c' + nowId);
          if (!ci_ele) ci_ele = newC(nowId);
          ci_ele.style.display = 'block';
          for (var i = 0; i < 4; i++) {
            var num = i + 1;
            var zi = value[i];
            var zi_ele = document.querySelector('#c' + nowId + ' .zi.z' + num);
            zi_ele.innerHTML = value[i];
            zi_ele.classList.remove('py');
            zi_ele.classList.remove('loc');
            zi_ele.classList.remove('eql');
            if (pyArr[i] && isPyMode) zi_ele.classList.add('py');
            if (locArr[i]) zi_ele.classList.add('loc');
            if (eqlArr[i]) zi_ele.classList.add('eql');
            else if(!isPyMode) zi_ele.classList.add('drop')
            var box_zis_num = box_zis.indexOf(zi) + 1;
            if (box_zis_num > 0) {
              var box_zi_ele = document.querySelector('#box .zi.z'+box_zis_num);
              if (eqlArr[i] && box_zi_ele.className.indexOf('eql') === -1) {
                box_zi_ele.classList.add('eql');
              }
              if (!eqlArr[i] && box_zi_ele.className.indexOf('drop') === -1) {
                box_zi_ele.classList.add('drop');
              }
            }
          }
        }
        var isPass = eqlArr[0] && eqlArr[1] && eqlArr[2] && eqlArr[3] && locArr[0] && locArr[1] && locArr[2] && locArr[3];
        if (isPass) {
          setTimeout(()=>{
            alert('æ­å–œä½ ï¼Œç­”å¯¹äº†ï¼');
            if (window.location.href.indexOf('tekii.cn') > -1) { // å¯ä»¥å»æ–°çš„å…³å¡äº†
              window.history.pushState({id: 1,name: "SpecialGame"}, "SpecialGame", "/cyle/");
            }
            if (confirm('æƒ³çœ‹çœ‹ '+tarCy+' çš„å…·ä½“è§£é‡Šä¹ˆï¼Ÿ')) {
              window.location.href = 'https://hanyu.baidu.com/zici/s?wd=' + encodeURIComponent(tarCy);
            }
          });
          
        } else if (nowId >= 6) {
          // nowId = 0; // ä»å¤´å¼€å§‹è®°å½•
          // setTimeout(()=>{alert(tarCy)}); // ç»™ç­”æ¡ˆ
          // return;
        }
        nowId++;
      }

      // é»˜è®¤ç™½åº•ç°å­—
      function checkPy(src, tar) {
        // é¦–å­—æ¯ï¼Œä¸€æ ·åˆ™é¢œè‰²å˜é»‘
        var checkArr = []
        for (var i = 0; i < 4; i++) {
          var isPy = false;
          for (var j = 0; j < 4; j++) {
            if (!isPy) isPy = src[i].spell()[0] === tar[j].spell()[0] // æœ‰ä¸€ä¸ªåˆ¤æ–­å¯¹å°±ç®—å¯¹
          }
          checkArr.push(isPy);
        }
        return checkArr
      }
      function checkLoc(src, tar) {
        // ä½ç½®ï¼Œä¸€æ ·åˆ™åº•è‰²å˜çº¢
        var checkArr = []
        for (var i = 0; i < 4; i++) {
          if (isPyMode) {
            var isLoc = src[i].spell()[0] === tar[i].spell()[0] // é¦–å­—æ¯å¯¹å°±ç®—å¯¹
          } else {
            var isLoc = src[i] === tar[i] // å­—ä¸€æ ·æ‰ç®—å¯¹
          }
          checkArr.push(isLoc)
        }
        return checkArr
      }
      function checkEql(src, tar) {
        // åŒå­—ï¼Œä¸€æ ·åˆ™é¢œè‰²å˜é‡‘
        var checkArr = []
        for (var i = 0; i < 4; i++) {
          var isEql = false;
          for (var j = 0; j < 4; j++) {
            if(!isEql) isEql = src[i] === tar[j] // æœ‰ä¸€ä¸ªåˆ¤æ–­å¯¹å°±ç®—å¯¹
          }
          checkArr.push(isEql);
        }
        return checkArr
      }
      function checkIsCy(src) {
        return cys.indexOf(src) > -1;
      }
  </script>
</body>
</html>