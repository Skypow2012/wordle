<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="./js/cys.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cnchar/cnchar.min.js"></script>
  <title>成语le</title>
  <style>
    body {
      text-align: center;
    }
    #root {
      --background: #efefef;
      --loc-background: #c22828;
      --color: #999999;
      --drop-color: #cccccc;
      --py-color: #12171b;
      --eql-color: #e1d791;
      --eql-background: #e1d791;
      --font-size: 28px;
      --border-color: #efefef;
      --zi-border-width: 0px;
    }
    #root {
      --background: #ffffff;
      --loc-background: #69a86a;
      --eql-background: #c9b457;
      --eql-color: #ffffff;
      --loc-color: #ffffff;
      --color: #1c1c1c;
      --border-color: #7b7b7b;
      --drop-color: #ffffff;
      --drop-background: #7d7d7d;
      --zi-border-width: 2px;
    }
    #box {
      border: 2px solid var(--border-color);
      padding: 2px;
      margin-top: 2px;
    }
    .chengyu {
      font-size: 0;
    }
    .chengyu:first-child {
      margin-left: 0px;
    }
    .zi {
      display: inline-block;
      margin: 2px;
      width: 60px;
      height: 60px;
      color: var(--color);
      background-color: var(--background);
      text-align: center;
      vertical-align: middle;
      line-height: 60px;
      font-size: var(--font-size);
      border: 2px solid var(--border-color);
      border-width: var(--zi-border-width);
    }
    .zi.py {
      color: var(--py-color) 
    }
    .zi.eql {
      color: var(--eql-color);
      background: var(--eql-background);
    }
    .zi.loc {
      color: var(--loc-color);
      background: var(--loc-background) 
    }
    .zi.drop {
      color: var(--drop-color);
      background: var(--drop-background);
    }
    #input {
      margin: 10px 0px;
    }
    #cyid {
      position: absolute;
      display: inline-block;
      width: 80px;
      top: 0;
      right: 0;
    }
  </style>
</head>
<body>
  <div class="box" id="root">
    <div class="chengyu" id="c">
      <div class="zi z1">天</div>
      <div class="zi z2"></div>
      <div class="zi z3"></div>
      <div class="zi z4"></div>
    </div>
    <div class="chengyu" id="box"></div>
    <input id="input" onsubmit="check()"></input>
    <button onclick="check()">提交</button>
    <div class="chengyu" id="c1" style="display: none;">
      <div class="zi z1"></div>
      <div class="zi z2"></div>
      <div class="zi z3"></div>
      <div class="zi z4"></div>
    </div>
    <div class="chengyu" id="c2" style="display: none;">
      <div class="zi z1"></div>
      <div class="zi z2"></div>
      <div class="zi z3"></div>
      <div class="zi z4"></div>
    </div>
    <div class="chengyu" id="c3" style="display: none;">
      <div class="zi z1"></div>
      <div class="zi z2"></div>
      <div class="zi z3"></div>
      <div class="zi z4"></div>
    </div>
    <div class="chengyu" id="c4" style="display: none;">
      <div class="zi z1"></div>
      <div class="zi z2"></div>
      <div class="zi z3"></div>
      <div class="zi z4"></div>
    </div>
    <div class="chengyu" id="c5" style="display: none;">
      <div class="zi z1"></div>
      <div class="zi z2"></div>
      <div class="zi z3"></div>
      <div class="zi z4"></div>
    </div>
    <div class="chengyu" id="c6" style="display: none;">
      <div class="zi z1"></div>
      <div class="zi z2"></div>
      <div class="zi z3"></div>
      <div class="zi z4"></div>
    </div>
    <div id="cyid" onclick="setId()"></div>
  </div>
  <script>
      console.log('汉字'.spell());
      var tarCy = '天下第一';
      var isRandom = true
      if (isRandom) {
        var randomId;
        if (window.location.href.indexOf('cyid') > -1) {
          randomId = window.location.href.match(/cyid=(\d*)/)[1]
        } else {
          randomId = Math.random()*cys.length|0;
          window.history.pushState({id: 1,name: "SpecialGame"}, "SpecialGame", "/cyle/?cyid="+randomId);
        }
        cyid.innerHTML = randomId;
        tarCy = cys[randomId];
        document.querySelector('.z1').innerHTML = '';
      }
      function setId() {
        var specialCyId = prompt('请输入成语id');
        if (specialCyId) {
          window.location.href = "/cyle/?cyid="+specialCyId
        }
      }
      var nowId = 1;
      var checkCnt = 0;

      function getBoxZis(size=10) {
        var box = document.querySelector('#box');
        var box_zis = []
        var true_zi = tarCy[Math.random() * tarCy.length | 0];
        var true_idx = Math.random() * size | 0;
        while (box_zis.length < size) {
          if (box_zis.length === true_idx) {
            box_zis.push(true_zi);
            continue;
          }
          var other_cy = cys[Math.random() * cys.length | 0];
          console.log(other_cy)
          var other_zi = other_cy[Math.random() * other_cy.length | 0].replace(/\s/g, '');
          console.log(other_zi)
          if (box_zis.indexOf(other_zi) == -1 && other_zi != true_zi) {
            box_zis.push(other_zi);
          }
        }
        for (var i = 0; i < box_zis.length; i++) {
          var zi = box_zis[i];
          var zi_el = document.createElement('div');
          zi_el.className = 'zi';
          zi_el.classList.add('z'+(i+1));
          zi_el.innerHTML = zi;
          box.appendChild(zi_el);
        }
        return box_zis;
      }
      var box_zis = getBoxZis()

      function check() {
        var input = document.getElementById('input');
        var value = input.value || '';
        value = value.replace(/\s/g, '')
        if (value.length === 0) {
          alert('请输入成语');
          return;
        }
        if (value.length < 4) {
          alert('成语长度不够');
          return;
        }
        if (value.length > 4) {
          alert('成语长度太长');
          return;
        }
        if (!checkIsCy(value)) {
          alert('请输入正确的成语');
          return;
        }
        var pyArr = checkPy(value, tarCy);
        var locArr = checkLoc(value, tarCy);
        var eqlArr = checkEql(value, tarCy);
        console.log(pyArr, locArr, eqlArr)
        update_cy('');
        update_cy(nowId);
        function update_cy(nowId) {
          document.querySelector('#c'+nowId).style.display = 'block';
          for (var i = 0; i < 4; i++) {
            var num = i + 1;
            var zi = value[i];
            var zi_ele = document.querySelector('#c' + nowId + ' .zi.z' + num);
            zi_ele.innerHTML = value[i];
            zi_ele.classList.remove('py');
            zi_ele.classList.remove('loc');
            zi_ele.classList.remove('eql');
            // if (pyArr[i]) zi_ele.classList.add('py');
            if (locArr[i]) zi_ele.classList.add('loc');
            if (eqlArr[i]) zi_ele.classList.add('eql');
            var box_zis_num = box_zis.indexOf(zi) + 1;
            console.log(box_zis_num, '#box .zi.z'+box_zis_num)
            if (box_zis_num > 0) {
              var box_zi_ele = document.querySelector('#box .zi.z'+box_zis_num);
              if (eqlArr[i] && box_zi_ele.className.indexOf('eql') === -1) {
                box_zi_ele.classList.add('eql');
              }
              if (!eqlArr[i] && box_zi_ele.className.indexOf('drop') === -1) {
                box_zi_ele.classList.add('drop');
              }
            }
          }
        }
        var isPass = eqlArr[0] && eqlArr[1] && eqlArr[2] && eqlArr[3] && locArr[0] && locArr[1] && locArr[2] && locArr[3];
        if (isPass) {
          setTimeout(()=>{
            alert('恭喜你，答对了！');
            if (confirm('想看看 '+tarCy+' 的具体解释么？')) {
              window.location.href = 'https://hanyu.baidu.com/zici/s?wd=' + encodeURIComponent(tarCy);
            }
          });
          
        } else if (nowId >= 6) {
          nowId = 0; // 从头开始记录
          // setTimeout(()=>{alert(tarCy)}); // 给答案
          // return;
        }
        nowId++;
      }

      // 默认白底灰字
      function checkPy(src, tar) {
        // 首字母，一样则颜色变黑
        var checkArr = []
        for (var i = 0; i < 4; i++) {
          var isPy = false;
          for (var j = 0; j < 4; j++) {
            if (!isPy) isPy = src[i].spell()[0] === tar[j].spell()[0] // 有一个判断对就算对
          }
          checkArr.push(isPy);
        }
        return checkArr
      }
      function checkLoc(src, tar) {
        // 位置，一样则底色变红
        var checkArr = []
        for (var i = 0; i < 4; i++) {
          // var isLoc = src[i].spell()[0] === tar[i].spell()[0] // 首字母对就算对
          var isLoc = src[i] === tar[i] // 字一样才算对
          checkArr.push(isLoc)
        }
        return checkArr
      }
      function checkEql(src, tar) {
        // 同字，一样则颜色变金
        var checkArr = []
        for (var i = 0; i < 4; i++) {
          var isEql = false;
          for (var j = 0; j < 4; j++) {
            if(!isEql) isEql = src[i] === tar[j] // 有一个判断对就算对
          }
          checkArr.push(isEql);
        }
        return checkArr
      }
      function checkIsCy(src) {
        return cys.indexOf(src) > -1;
      }
  </script>
</body>
</html>